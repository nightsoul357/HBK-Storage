@page "/storageGroup/manage"
@attribute [Authorize]
@inherits PageBase<ManageStorageGroup>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-16">
    <MudGrid>
        <MudItem xs="12" md="12">
            <MudText Typo="Typo.h3" GutterBottom="true">管理儲存群組</MudText>
        </MudItem>
        <MudItem xs="12" md="12">
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="this.ShowAddDialogAsync">新增儲存群組</MudButton>
        </MudItem>
        <MudItem xs="12" md="12">
            <MudTable ServerData="@(new Func<TableState, Task<TableData<StorageGroupExtendPropertyResponse>>>(this.ServerReloadAsync))"
                      Dense="true" Hover="true" @ref="_table">
                <ToolBarContent>
                    <MudText Typo="Typo.h6">儲存群組列表</MudText>
                    <MudSpacer />
                    <MudTextField T="string" ValueChanged="@(async s => await this.OnSearchAsync(s))" Placeholder="Search" Adornment="Adornment.Start"
                                  AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
                    <MudIconButton Icon="@Icons.Material.Filled.Refresh" aria-label="refresh" OnClick="async () => await _table.ReloadServerData()"></MudIconButton>
                </ToolBarContent>
                <HeaderContent>
                    <MudTh>儲存群組 ID</MudTh>
                    <MudTh><MudTableSortLabel SortLabel="storage_group/name" T="StorageGroupExtendPropertyResponse">名稱</MudTableSortLabel></MudTh>
                    <MudTh><MudTableSortLabel SortLabel="storage_group/type" T="StorageGroupExtendPropertyResponse">類型</MudTableSortLabel></MudTh>
                    <MudTh><MudTableSortLabel SortLabel="storage_group/sync_mode" T="StorageGroupExtendPropertyResponse">同步模式</MudTableSortLabel></MudTh>
                    <MudTh><MudTableSortLabel SortLabel="used_size" T="StorageGroupExtendPropertyResponse">已使用空間</MudTableSortLabel></MudTh>
                    <MudTh><MudTableSortLabel SortLabel="storage_group/upload_priority" T="StorageGroupExtendPropertyResponse">上傳優先度</MudTableSortLabel></MudTh>
                    <MudTh><MudTableSortLabel SortLabel="storage_group/download_priority" T="StorageGroupExtendPropertyResponse">下載優先度</MudTableSortLabel></MudTh>
                    <MudTh><MudTableSortLabel SortLabel="storage_group/create_date_time" T="StorageGroupExtendPropertyResponse">建立時間</MudTableSortLabel></MudTh>
                    <MudTh>狀態</MudTh>
                    <MudTh>功能</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd>@context.Storage_group_id</MudTd>
                    <MudTd DataLabel="storage_group/name">@context.Name</MudTd>
                    <MudTd DataLabel="storage_group/type">@context.Type.ToString()</MudTd>
                    <MudTd DataLabel="storage_group/sync_mode">@context.Sync_mode.ToString()</MudTd>
                    <MudTd DataLabel="used_size">@DataUnitFormatHelper.Format(context.Used_size ?? 0) / @DataUnitFormatHelper.Format(context.Size_limit ?? 0)</MudTd>
                    <MudTd DataLabel="storage_group/upload_priority">@context.Upload_priority</MudTd>
                    <MudTd DataLabel="storage_group/download_priority">@context.Download_priority</MudTd>
                    <MudTd DataLabel="storage_group/create_date_time">@context.Create_date_time.ToLocalTime().ToString("yyyy/MM/dd HH:mm:ss")</MudTd>
                    <MudTd>
                        @foreach (var status in context.Status)
                        {
                            <MudText>
                                @status.ToString()
                            </MudText>
                        }
                    </MudTd>
                    <MudTd>
                        <MudButton Variant="Variant.Outlined" Size="Size.Small" Color="Color.Info" OnClick="() => this.NavigateToManage(context)">管理</MudButton>
                        <MudButton Variant="Variant.Outlined" Size="Size.Small" Color="Color.Info" OnClick="async () => await this.ShowEditDialogAsync(context)">編輯</MudButton>
                        <MudButton Variant="Variant.Outlined" Size="Size.Small" Color="Color.Error" OnClick="async () => await this.ShowDeleteDialogAsync(context)">刪除</MudButton>
                    </MudTd>
                </RowTemplate>
                <NoRecordsContent>
                    <MudText>未找到任何資料</MudText>
                </NoRecordsContent>
                <LoadingContent>
                    <MudText>正在載入中...</MudText>
                </LoadingContent>
                <PagerContent>
                    <MudTablePager />
                </PagerContent>
            </MudTable>
        </MudItem>
    </MudGrid>
</MudContainer>